{% extends 'layouts/layout-adherent.html.twig' %}{%block title%}Espace adhérent{%endblock%} {% block body %}

<!-- BEGIN PAGE BAR -->
<div class="page-bar">
    <ul class="page-breadcrumb">
        <li>
            <a href="#">Espace adhérent</a>
            <i class="fa fa-circle"></i>
        </li>
        <li>
            <span>Opérations</span>
            <i class="fa fa-circle"></i>
        </li>
        <li>
            <span>Demande souscription au dépôt à terme à versement progressif</span>
        </li>
    </ul>
    <div class="page-breadcrumb pull-right">
        <div class="badge badge-orange">
            Espace sécurisé <i class="fa fa-lock"></i>
        </div>
    </div>
</div>
<!-- END PAGE BAR -->
<!-- BEGIN PAGE TITLE-->
<h1 class="page-title">Demande de souscription au dépôt à terme à versement progressif</h1>
<!-- END PAGE TITLE-->
<!-- END PAGE HEADER-->

<div class="row">

    {% for message in app.session.flashbag.get('success') %}
    <div class="row">
        <div class="col-md-8 col-md-offset-2">
            <div class="alert alert-block alert-success fade in">
                <button type="button" class="close" data-dismiss="alert"></button>
                <p>
                    <stronng>{{message}}</stronng>
                </p>
            </div>
        </div>
    </div>
    {% endfor %} {% for message in app.session.flashbag.get('error') %}
    <div class="row">
        <div class="col-md-8 col-md-offset-2">
            <div class="alert alert-block alert-danger fade in">
                <button type="button" class="close" data-dismiss="alert"></button>
                <p>
                    <stronng>{{message}}</stronng>
                </p>
            </div>
        </div>
    </div>
    {% endfor %}
    <div class="portlet light bordered">
        <div class="portlet-title">
            <div class="caption font-green-sharp">
                <i class="fa fa-pencil-square-o font-green-sharp"></i>
                <span class="caption-subject bold uppercase"> Formulaire de demande de souscription au dépôt à terme à
                    versement progressif</span>
            </div>
        </div>
        <div class="portlet-body">
            <form class="form-horizontal formSubmit" role="form" action="{{path('save_souscription_dat_progressif')}}" method="post" id="form">
                <div class="form-body">
                    <div class="form-group">
                        <label class="col-md-4 control-label">Quotité cessible</label>
                        <div class="col-md-5">
                            <input type="text" class="form-control separate" placeholder="Quotité cessible" name="quotite_cessible" id="quotite_cessible">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-md-4 control-label">Retenue mensuelle</label>
                        <div class="col-md-5">
                            <div class="input-group">
                                <input type="text" class="form-control separate" placeholder="Retenue mensuelle" name="retenue_mensuelle" id="retenue_mensuelle" required>
                                <span class="input-group-addon"> F CFA</span>
                            </div>
                        </div>
                    </div>

                    <div class=" form-group">
                        <label class="control-label col-md-4">Période de retenue</label>
                        <div class="col-md-4">
                            <div class="input-group input-large date-picker input-daterange" id="periode" data-date-format="dd/mm/yyyy" data-date-start-date="+0d">
                                <input type="text" class="form-control" name="date_start" id="date_start" placeholder="Date de début" required autocomplete="off">
                                <span class="input-group-addon"> au </span>
                                <input type="text" class="form-control" name="date_end" id="date_end" placeholder="Date de fin" required autocomplete="off"> </div>
                        </div>
                        <div class="col-md-2">
                            <label for="" class="control-label">
                                <div id="nb_mois"></div>
                            </label>
                        </div>

                    </div>

                    <div class=" form-group">
                        <label class="control-label col-md-4">Montant total à la fin de mon épargne</label>
                        <div class="col-md-5">
                            <div class="input-group">
                                <input type="text" class="form-control separate" placeholder="Epargne constituée" name="montant_epargne" id="montant_epargne" readonly>
                                <span class="input-group-addon">
                                    F CFA
                                </span>
                            </div>
                        </div>
                    </div>

                    <!--div class="form-group">
                        <label class="col-md-4 control-label">Conditions de renouvellement</label>
                        <div class="col-md-5">
                            <select name="condition_renouvellement" id="condition_renouvellement" class="form-control">
                                <option>Simple</option>
                                <option>Progressive</option>
                                <option>Aucun renouvellement</option>
                            </select>
                        </div>
                    </div-->

                    <div class="form-group">
                        <label class="col-md-4 control-label">Date de la demande</label>
                        <div class="col-md-5">
                            <input disabled type="text" class="form-control" placeholder="Date de souscription" value='{{ "now"|date("d/m/Y") }}'>
                        </div>
                    </div>
                    <!--div class="col-md-8 col-md-offset-2">
                        <div class="alert alert-danger">
                            <i class="fa fa-info-circle font-red"></i> Je m'engage à <strong>informer par écrit</strong> la Mutuelle de toute modification éventuelle, <strong> au moins un mois avant</strong> le terme de mon DAT à versement progressif.

                        </div>
                    </div-->
                </div>

                <div class="form-actions">
                    <div class="row">
                        <div class="col-md-offset-4 col-md-8">
                            <button class="btn green btnSubmit" type="button">
                                <i class="fa fa-check"></i> Valider</button>
                            <button type="button" class="btn btn-default">Annuler</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

{%block javascript %}
<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>

<script>
    $(document).ready(function(e) {
        function monthDiff(d1, d2) {
            var months;
            months = (d2.getFullYear() - d1.getFullYear()) * 12;
            months -= d1.getMonth() + 1;
            months += d2.getMonth();
            // edit: increment months if d2 comes later in its month than d1 in its month
            if (d2.getDate() >= d1.getDate())
                months++
                // end edit

                if (isNaN(months)) {
                    return months = 0;
                } else {

                    return months <= 0 ? 0 : months;
                }
        }

        $('#date_end').add('#date_start').add('#retenue_mensuelle').change(function(e) {
            
            var retenueVal = $('#retenue_mensuelle').val();
            var retenueSplit = $('#retenue_mensuelle').val().split(" ");
            if(typeof retenueSplit[1] === "undefined"){
                var retenue = retenueSplit[0];
            }
            
            if(typeof retenueSplit[1] != "undefined"){
                var retenue = retenueSplit[0]+retenueSplit[1];
            }
            //alert(retenue)
            //changer le format de la date
            var split_start = $('#date_start').val().split('/');
            var date_start = new Date(split_start[1] + "/" + split_start[0] + "/" + split_start[2]);

            var split_end = $('#date_end').val().split('/');
            var date_end = new Date(split_end[1] + "/" + split_end[0] + "/" + split_end[2]);



            //var date_start = new Date($('#date_start').val());
            //var date_end = new Date($('#date_end').val());
            
            var mois = monthDiff(date_start, date_end); //On retourne le nombre de mois

            var montant_epargne = retenue * mois;

            $('#nb_mois').html(mois + " MOIS").addClass("font-yellow-gold bold");
            
            $('#montant_epargne').val(montant_epargne);
        });
    });
</script>

{%endblock%}
{% endblock %}